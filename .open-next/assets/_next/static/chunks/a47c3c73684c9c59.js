(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32036,e=>{"use strict";function t(e){return e.toLocaleString("ja-JP")}function a(e){return`\xa5${e.toLocaleString("ja-JP")}`}function r(e){return("string"==typeof e?new Date(e):e).toLocaleDateString("ja-JP",{year:"numeric",month:"short",day:"numeric"})}function s(e){return("string"==typeof e?new Date(e):e).toLocaleString("ja-JP",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function i(e){let t="string"==typeof e?new Date(e):e,a=Math.floor((new Date().getTime()-t.getTime())/1e3),s=Math.floor(a/60),i=Math.floor(s/60),l=Math.floor(i/24);return a<60?"たった今":s<60?`${s}分前`:i<24?`${i}時間前`:l<7?`${l}日前`:r(t)}e.s(["formatCoins",()=>t,"formatDate",()=>r,"formatDateTime",()=>s,"formatPrice",()=>a,"formatRelativeTime",()=>i])},89271,e=>{"use strict";e.s(["CATEGORY_LABELS",0,{all:"すべて",sneaker:"スニーカー",card:"トレカ",figure:"フィギュア",game:"ゲーム",other:"その他"},"RARITY_CONFIG",0,{N:{label:"N",color:"#9ca3af",bg:"#374151",glow:""},R:{label:"R",color:"#60a5fa",bg:"#1e3a5f",glow:""},SR:{label:"SR",color:"#a78bfa",bg:"#3b1f7a",glow:"0 0 20px rgba(167,139,250,0.5)"},SSR:{label:"SSR",color:"#fbbf24",bg:"#78350f",glow:"0 0 30px rgba(251,191,36,0.6)"},UR:{label:"UR",color:"#f472b6",bg:"#831843",glow:"0 0 40px rgba(244,114,182,0.7)"}}])},96640,e=>{"use strict";var t=e.i(43476),a=e.i(89271);function r({rarity:e}){let r=a.RARITY_CONFIG[e];return(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-bold",style:{color:r.color,backgroundColor:r.bg},children:r.label})}e.s(["default",()=>r])},43504,e=>{"use strict";var t=e.i(43476),a=e.i(49838);function r({label:e,error:r,children:s,className:i}){return(0,t.jsxs)("div",{className:(0,a.cn)("space-y-1",i),children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-300",children:e}),s,r&&(0,t.jsx)("p",{className:"text-xs text-red-400",children:r})]})}e.s(["default",()=>r])},86686,e=>{"use strict";var t=e.i(43476),a=e.i(32098),r=e.i(59544);function s({isOpen:e,onClose:s,onConfirm:i,title:l,message:n,confirmLabel:o="削除",loading:c=!1}){return(0,t.jsx)(a.default,{isOpen:e,onClose:s,children:(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:l}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-6",children:n}),(0,t.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,t.jsx)(r.default,{variant:"ghost",size:"sm",onClick:s,children:"キャンセル"}),(0,t.jsx)(r.default,{variant:"danger",size:"sm",onClick:i,disabled:c,children:c?"処理中...":o})]})]})})}e.s(["default",()=>s])},19711,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(18566),s=e.i(53145),i=e.i(94814),l=e.i(81307),n=e.i(59544),o=e.i(96640),c=e.i(43504),d=e.i(86686),m=e.i(32098),u=e.i(89271),p=e.i(32036);let x=l.z.object({title:l.z.string().min(1,"タイトルを入力してください"),description:l.z.string().optional().default(""),image:l.z.string().url("有効なURLを入力してください"),category:l.z.enum(["sneaker","card","figure","game","other"]),pricePerDraw:l.z.coerce.number().int().min(1),totalStock:l.z.coerce.number().int().min(1),limitPerUser:l.z.coerce.number().int().min(1).nullable().optional().transform(e=>e||null),startsAt:l.z.string().optional().default(""),endsAt:l.z.string().optional().default(""),featured:l.z.boolean().optional().default(!1),lastOnePrizeId:l.z.string().nullable().optional(),sortOrder:l.z.coerce.number().int().optional().default(0)}),f=l.z.object({prizeId:l.z.string().min(1,"景品を選択してください"),weight:l.z.coerce.number().int().min(1,"1以上を入力"),totalQuantity:l.z.coerce.number().int().min(1,"1以上を入力")}),h="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-gold-mid",g=Object.entries(u.CATEGORY_LABELS).filter(([e])=>"all"!==e);function j(e){if(!e)return"";let t=new Date(e),a=t.getTimezoneOffset();return new Date(t.getTime()-6e4*a).toISOString().slice(0,16)}function b({params:e}){let{id:l}=(0,a.use)(e),u=(0,r.useRouter)(),[b,y]=(0,a.useState)(null),[N,z]=(0,a.useState)(!0),[w,S]=(0,a.useState)(!1),[k,v]=(0,a.useState)(!1),[P,C]=(0,a.useState)(!1),[T,O]=(0,a.useState)(!1),[A,R]=(0,a.useState)(null),[D,E]=(0,a.useState)([]),[I,L]=(0,a.useState)(!1),{register:U,handleSubmit:$,reset:F,formState:{errors:J}}=(0,s.useForm)({resolver:(0,i.zodResolver)(x)}),Q=(0,s.useForm)({resolver:(0,i.zodResolver)(f)});async function B(){let e=await fetch(`/api/admin/packs/${l}`);if(!e.ok)return void u.push("/admin/packs");let t=await e.json();y(t),F({title:t.title,description:t.description,image:t.image,category:t.category,pricePerDraw:t.pricePerDraw,totalStock:t.totalStock,limitPerUser:t.limitPerUser,startsAt:j(t.startsAt),endsAt:j(t.endsAt),featured:t.featured,lastOnePrizeId:t.lastOnePrizeId,sortOrder:t.sortOrder}),z(!1)}async function G(e){S(!0);try{if(!(await fetch(`/api/admin/packs/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,startsAt:e.startsAt||null,endsAt:e.endsAt||null})})).ok)throw Error("Failed to update");await B(),alert("保存しました")}catch{alert("保存に失敗しました")}finally{S(!1)}}async function M(e){(await fetch(`/api/admin/packs/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})})).ok?await B():alert("ステータス変更に失敗しました")}async function Y(){C(!0);try{let e=await fetch(`/api/admin/packs/${l}`,{method:"DELETE"});if(!e.ok){let t=await e.json();alert(t.error||"削除に失敗しました");return}u.push("/admin/packs")}finally{C(!1),v(!1)}}async function _(e){L(!0);try{let t=await fetch(`/api/admin/packs/${l}/prizes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();alert(e.error||"追加に失敗しました");return}O(!1),Q.reset(),await B()}finally{L(!1)}}async function K(){if(!A)return;let e=await fetch(`/api/admin/packs/${l}/prizes?packPrizeId=${A}`,{method:"DELETE"});e.ok?await B():alert((await e.json()).error||"削除に失敗しました"),R(null)}if((0,a.useEffect)(()=>{B(),fetch("/api/admin/prizes").then(e=>e.json()).then(e=>E(e))},[l]),N||!b)return(0,t.jsx)("p",{className:"text-center text-gray-500 py-20",children:"読み込み中..."});let V=b.packPrizes.reduce((e,t)=>e+t.weight,0),q="DRAFT"===b.status;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"パック編集"}),(0,t.jsxs)("div",{className:"flex gap-2",children:["DRAFT"===b.status&&(0,t.jsx)(n.default,{size:"sm",onClick:()=>M("ACTIVE"),children:"公開する"}),"ACTIVE"===b.status&&(0,t.jsx)(n.default,{size:"sm",variant:"outline",onClick:()=>M("ENDED"),children:"終了する"}),q&&(0,t.jsx)(n.default,{size:"sm",variant:"danger",onClick:()=>v(!0),children:"削除"})]})]}),(0,t.jsxs)("form",{onSubmit:$(G),className:"max-w-2xl space-y-4 bg-gray-900 border border-gray-800 rounded-xl p-6",children:[(0,t.jsx)(c.default,{label:"タイトル",error:J.title?.message,children:(0,t.jsx)("input",{...U("title"),className:h})}),(0,t.jsx)(c.default,{label:"説明",error:J.description?.message,children:(0,t.jsx)("textarea",{...U("description"),rows:3,className:h})}),(0,t.jsx)(c.default,{label:"画像URL",error:J.image?.message,children:(0,t.jsx)("input",{...U("image"),className:h})}),(0,t.jsx)(c.default,{label:"カテゴリ",error:J.category?.message,children:(0,t.jsx)("select",{...U("category"),className:h,children:g.map(([e,a])=>(0,t.jsx)("option",{value:e,children:a},e))})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(c.default,{label:"1回あたりの価格(コイン)",error:J.pricePerDraw?.message,children:(0,t.jsx)("input",{type:"number",...U("pricePerDraw"),className:h})}),(0,t.jsx)(c.default,{label:"総在庫数",error:J.totalStock?.message,children:(0,t.jsx)("input",{type:"number",...U("totalStock"),className:h})})]}),(0,t.jsx)(c.default,{label:"ユーザーあたりの制限(任意)",children:(0,t.jsx)("input",{type:"number",...U("limitPerUser"),placeholder:"制限なし",className:h})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(c.default,{label:"開始日時(任意)",children:(0,t.jsx)("input",{type:"datetime-local",...U("startsAt"),className:h})}),(0,t.jsx)(c.default,{label:"終了日時(任意)",children:(0,t.jsx)("input",{type:"datetime-local",...U("endsAt"),className:h})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(c.default,{label:"表示順",children:(0,t.jsx)("input",{type:"number",...U("sortOrder"),className:h})}),(0,t.jsx)(c.default,{label:"ラストワン景品",children:(0,t.jsxs)("select",{...U("lastOnePrizeId"),className:h,children:[(0,t.jsx)("option",{value:"",children:"なし"}),b.packPrizes.map(e=>(0,t.jsx)("option",{value:e.prize.id,children:e.prize.name},e.prize.id))]})})]}),(0,t.jsx)(c.default,{label:"",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm text-gray-300 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",...U("featured"),className:"rounded border-gray-600 bg-gray-800 text-gold-mid focus:ring-gold-mid"}),"注目パックとして表示"]})}),(0,t.jsx)("div",{className:"pt-4",children:(0,t.jsx)(n.default,{type:"submit",disabled:w,children:w?"保存中...":"保存"})})]}),(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h2",{className:"text-lg font-bold",children:"景品一覧"}),(0,t.jsx)(n.default,{size:"sm",onClick:()=>O(!0),children:"景品追加"})]}),0===b.packPrizes.length?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"景品が追加されていません"}):(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-gray-800 text-left",children:[(0,t.jsx)("th",{className:"px-3 py-2 text-gray-400 font-medium",children:"景品名"}),(0,t.jsx)("th",{className:"px-3 py-2 text-gray-400 font-medium",children:"レアリティ"}),(0,t.jsx)("th",{className:"px-3 py-2 text-gray-400 font-medium",children:"重み"}),(0,t.jsx)("th",{className:"px-3 py-2 text-gray-400 font-medium",children:"数量"}),(0,t.jsx)("th",{className:"px-3 py-2 text-gray-400 font-medium",children:"確率"}),(0,t.jsx)("th",{className:"px-3 py-2 text-gray-400 font-medium",children:"操作"})]})}),(0,t.jsx)("tbody",{children:b.packPrizes.map(e=>(0,t.jsxs)("tr",{className:"border-b border-gray-800/50",children:[(0,t.jsx)("td",{className:"px-3 py-2",children:e.prize.name}),(0,t.jsx)("td",{className:"px-3 py-2",children:(0,t.jsx)(o.default,{rarity:e.prize.rarity})}),(0,t.jsx)("td",{className:"px-3 py-2",children:e.weight}),(0,t.jsxs)("td",{className:"px-3 py-2",children:[e.remainingQuantity," / ",e.totalQuantity]}),(0,t.jsx)("td",{className:"px-3 py-2",children:V>0?`${(e.weight/V*100).toFixed(2)}%`:"—"}),(0,t.jsx)("td",{className:"px-3 py-2",children:q&&(0,t.jsx)(n.default,{variant:"danger",size:"sm",onClick:()=>R(e.id),children:"削除"})})]},e.id))})]})]}),(0,t.jsx)(m.default,{isOpen:T,onClose:()=>O(!1),children:(0,t.jsxs)("div",{className:"bg-gray-900 border border-gray-700 rounded-xl p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-4",children:"景品を追加"}),(0,t.jsxs)("form",{onSubmit:Q.handleSubmit(_),className:"space-y-4",children:[(0,t.jsx)(c.default,{label:"景品",error:Q.formState.errors.prizeId?.message,children:(0,t.jsxs)("select",{...Q.register("prizeId"),className:h,children:[(0,t.jsx)("option",{value:"",children:"選択してください"}),D.filter(e=>!b.packPrizes.some(t=>t.prizeId===e.id)).map(e=>(0,t.jsxs)("option",{value:e.id,children:["[",e.rarity,"] ",e.name," (",(0,p.formatPrice)(e.marketPrice),")"]},e.id))]})}),(0,t.jsx)(c.default,{label:"重み(確率ウェイト)",error:Q.formState.errors.weight?.message,children:(0,t.jsx)("input",{type:"number",...Q.register("weight"),className:h})}),(0,t.jsx)(c.default,{label:"数量",error:Q.formState.errors.totalQuantity?.message,children:(0,t.jsx)("input",{type:"number",...Q.register("totalQuantity"),className:h})}),(0,t.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,t.jsx)(n.default,{type:"submit",size:"sm",disabled:I,children:I?"追加中...":"追加"}),(0,t.jsx)(n.default,{type:"button",variant:"ghost",size:"sm",onClick:()=>O(!1),children:"キャンセル"})]})]})]})}),(0,t.jsx)(d.default,{isOpen:k,onClose:()=>v(!1),onConfirm:Y,title:"パック削除",message:"このパックを削除しますか？この操作は元に戻せません。",loading:P}),(0,t.jsx)(d.default,{isOpen:!!A,onClose:()=>R(null),onConfirm:K,title:"景品削除",message:"この景品をパックから削除しますか？"})]})}e.s(["default",()=>b])}]);